{% extends "global/pages/base.html" %}

{% block title %}Início{% endblock title %}

{% block content %}
<div class="container-fluid pt-2">
    <div class="card mb-4">
        <div class="card-body d-flex justify-content-between align-items-start gap-3">
            <div>
                <h2 class="h4 mb-2">Olá, {{ user.first_name|default:user.username }}!</h2>
                <p class="mb-1"><strong>Empresa:</strong> {{ company.name }}</p>
                <p class="mb-0"><strong>CNPJ:</strong> {{ company.cnpj|default:"-" }}</p>
            </div>
            {% if perms.companies.add_employee and perms.companies.manage_company_features %}
                <a href="{% url 'companies:company_configuration' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-gear-fill me-1"></i>
                    Configurações
                </a>
            {% endif %}
        </div>
    </div>

    <h3 class="h5 mb-3">Aplicativos</h3>
    <div class="row g-3">
        {% for card in feature_cards %}
            <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
            {% if card.target_url %}
                <a href="{{ card.target_url }}" class="text-decoration-none">
                    <div class="card h-100 border-primary-subtle bg-primary-subtle">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <span class="fw-semibold">{{ card.name }}</span>
                            <span class="small text-body-secondary">{{ card.code }}</span>
                        </div>
                    </div>
                </a>
            {% else %}
                <div class="card h-100 text-bg-light border-secondary-subtle">
                    <div class="card-body d-flex flex-column justify-content-between">
                        <span class="fw-semibold text-secondary">{{ card.name }}</span>
                        <span class="small text-secondary">
                            {% if not card.is_granted %}
                                {{ card.code }} (not granted)
                            {% elif not card.is_enabled %}
                                {{ card.code }} (disabled)
                            {% else %}
                                {{ card.code }} (unavailable)
                            {% endif %}
                        </span>
                    </div>
                </div>
            {% endif %}
            </div>
        {% empty %}
            <p class="text-muted">No features configured.</p>
        {% endfor %}
    </div>

    <div class="card mt-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3 gap-2">
                <h3 class="h5 mb-0">Funcionários cadastrados</h3>
                <a href="{% url 'companies:employees' %}" class="btn btn-sm btn-outline-primary">Ver todos</a>
            </div>
            <div class="table-responsive">
                <table class="table table-sm table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Usuário</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in employees %}
                            <tr>
                                <td>{{ employee.user.first_name|default:"-" }} {{ employee.user.last_name|default:"" }}</td>
                                <td>{{ employee.user.username }}</td>
                                <td>{{ employee.user.email|default:"-" }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="3" class="text-muted">No employees registered.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
